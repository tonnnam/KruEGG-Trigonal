<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÄ‡∏Å‡∏°‡∏ï‡∏£‡∏µ‡πÇ‡∏Å‡∏ì‡∏°‡∏¥‡∏ï‡∏¥ - ‡∏î‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î</title>
    <script src="[https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.js](https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.js)"></script>
    <style>
        @import url('[https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap](https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap)');

        body {
            font-family: 'Kanit', sans-serif;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #1e1b4b, #7c3aed, #ec4899);
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            transform: scale(1.05);
            background: linear-gradient(135deg, #2563eb, #7c3aed);
        }
        .btn-secondary {
            background: linear-gradient(135deg, #f59e0b, #f97316);
            transition: all 0.3s ease;
        }
        .btn-secondary:hover {
            transform: scale(1.05);
            background: linear-gradient(135deg, #d97706, #ea580c);
        }
        .btn-success {
            background: linear-gradient(135deg, #10b981, #059669);
            transition: all 0.3s ease;
        }
        .btn-success:hover {
            transform: scale(1.05);
            background: linear-gradient(135deg, #059669, #047857);
        }
        .animate-pulse-slow {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        .difficulty-easy { background: rgba(16, 185, 129, 0.2); color: #10b981; }
        .difficulty-medium { background: rgba(245, 158, 11, 0.2); color: #f59e0b; }
        .difficulty-hard { background: rgba(249, 115, 22, 0.2); color: #f97316; }
        .difficulty-expert { background: rgba(239, 68, 68, 0.2); color: #ef4444; }

        .feedback-correct { background: rgba(16, 185, 129, 0.2); border-left: 4px solid #10b981; }
        .feedback-wrong { background: rgba(239, 68, 68, 0.2); border-left: 4px solid #ef4444; }
        .feedback-hint { background: rgba(245, 158, 11, 0.2); border-left: 4px solid #f59e0b; }

        input:focus {
            outline: none;
            border-color: #fbbf24;
            box-shadow: 0 0 0 3px rgba(251, 191, 36, 0.1);
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <div class="container mx-auto px-6 py-8 max-w-2xl">
        <div class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-white mb-2 flex items-center justify-center gap-3">
                üî¢ ‡πÄ‡∏Å‡∏°‡∏ï‡∏£‡∏µ‡πÇ‡∏Å‡∏ì‡∏°‡∏¥‡∏ï‡∏¥
                <svg class="w-8 h-8 text-yellow-400 animate-pulse-slow" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M2 12C2 6.48 6.48 2 12 2s10 4.48 10 10-4.48 10-10 10S2 17.52 2 12zm4.64-1.96l3.54 3.54 7.07-7.07 1.41 1.41L9.18 17.4l-4.95-4.95 1.41-1.41z"/>
                </svg>
            </h1>
            <p class="text-purple-200 text-lg">‡∏î‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î - ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏õ‡∏•‡∏≤‡∏¢</p>
        </div>

        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
            <div class="glass-card rounded-lg p-4 text-center">
                <div class="text-2xl font-bold text-white" id="level-display">1</div>
                <div class="text-sm text-purple-200">‡∏î‡πà‡∏≤‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</div>
            </div>
            <div class="glass-card rounded-lg p-4 text-center">
                <div class="text-2xl font-bold text-yellow-400 flex items-center justify-center gap-1">
                    ‚≠ê <span id="score-display">0</span>
                </div>
                <div class="text-sm text-purple-200">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div>
            </div>
            <div class="glass-card rounded-lg p-4 text-center">
                <div class="text-2xl font-bold text-orange-400 flex items-center justify-center gap-1">
                    üî• <span id="streak-display">0</span>
                </div>
                <div class="text-sm text-purple-200">‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á</div>
            </div>
            <div class="glass-card rounded-lg p-4 text-center">
                <div class="text-2xl font-bold text-green-400" id="best-streak-display">0</div>
                <div class="text-sm text-purple-200">‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</div>
            </div>
        </div>

        <div class="flex justify-center mb-6">
            <div id="difficulty-badge" class="rounded-full px-4 py-2 font-semibold">
                ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å: ‡∏á‡πà‡∏≤‡∏¢
            </div>
        </div>

        <div class="glass-card rounded-xl p-8 shadow-2xl">
            <div class="mb-8">
                <div class="bg-white bg-opacity-20 rounded-lg p-6 mb-4">
                    <h3 class="text-xl font-semibold text-white mb-2">‡πÇ‡∏à‡∏ó‡∏¢‡πå:</h3>
                    <p class="text-lg text-purple-100" id="question-display">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
                </div>

                <div class="mb-4">
                    <input
                        type="text"
                        id="answer-input"
                        placeholder="‡πÉ‡∏™‡πà‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö (‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏° 3 ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏≤‡∏°‡πÇ‡∏à‡∏ó‡∏¢‡πå)"
                        class="w-full p-4 border-2 border-white border-opacity-30 rounded-lg text-lg bg-white bg-opacity-10 text-white placeholder-purple-200"
                    />
                </div>

                <div class="flex gap-3 mb-4">
                    <button
                        id="check-btn"
                        class="flex-1 btn-primary text-white py-3 px-6 rounded-lg font-semibold"
                    >
                        ‡∏ï‡∏£‡∏ß‡∏à‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö
                    </button>
                    <button
                        id="hint-btn"
                        class="btn-secondary text-white py-3 px-6 rounded-lg font-semibold"
                    >
                        ‡∏Ç‡∏≠‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ
                    </button>
                </div>

                <div id="hint-display" class="hidden feedback-hint p-4 mb-4 rounded">
                    <p class="text-yellow-100">
                        <strong>‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ:</strong> <span id="hint-text"></span>
                    </p>
                </div>

                <div id="feedback-display" class="hidden p-4 rounded-lg mb-4">
                    <div class="flex items-start gap-2">
                        <span id="feedback-icon" class="text-xl"></span>
                        <pre class="whitespace-pre-wrap font-sans" id="feedback-text"></pre>
                    </div>
                </div>

                <button
                    id="next-btn"
                    class="hidden w-full btn-success text-white py-3 px-6 rounded-lg font-semibold flex items-center justify-center gap-2"
                >
                    ‡πÑ‡∏õ‡∏î‡πà‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏õ
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M8.59 16.34L13.17 12L8.59 7.66L10 6.24L16.76 12L10 17.76L8.59 16.34Z"/>
                    </svg>
                </button>
            </div>
        </div>

        <div class="text-center mt-6">
            <button
                id="reset-btn"
                class="bg-white bg-opacity-20 hover:bg-opacity-30 text-white py-2 px-6 rounded-lg font-semibold transition-colors"
            >
                ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡∏°‡πà
            </button>
        </div>
    </div>

<script>
    class TrigonometryGame {
        constructor() {
            this.currentLevel = 1;
            this.score = 0;
            this.streak = 0;
            this.bestStreak = 0;
            this.currentProblem = null;
            this.showingHint = false;

            this.initializeElements();
            this.bindEvents();
            this.generateNewProblem();
            this.updateDisplay();
        }

        initializeElements() {
            this.elements = {
                levelDisplay: document.getElementById('level-display'),
                scoreDisplay: document.getElementById('score-display'),
                streakDisplay: document.getElementById('streak-display'),
                bestStreakDisplay: document.getElementById('best-streak-display'),
                difficultyBadge: document.getElementById('difficulty-badge'),
                questionDisplay: document.getElementById('question-display'),
                answerInput: document.getElementById('answer-input'),
                checkBtn: document.getElementById('check-btn'),
                hintBtn: document.getElementById('hint-btn'),
                hintDisplay: document.getElementById('hint-display'),
                hintText: document.getElementById('hint-text'),
                feedbackDisplay: document.getElementById('feedback-display'),
                feedbackIcon: document.getElementById('feedback-icon'),
                feedbackText: document.getElementById('feedback-text'),
                nextBtn: document.getElementById('next-btn'),
                resetBtn: document.getElementById('reset-btn')
            };
        }

        bindEvents() {
            this.elements.checkBtn.addEventListener('click', () => this.checkAnswer());
            this.elements.hintBtn.addEventListener('click', () => this.toggleHint());
            this.elements.nextBtn.addEventListener('click', () => this.nextLevel());
            this.elements.resetBtn.addEventListener('click', () => this.resetGame());
            
            this.elements.answerInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    // Prevent form submission if it's inside a form
                    e.preventDefault(); 
                    if (!this.elements.nextBtn.classList.contains('hidden')) {
                         this.nextLevel();
                    } else {
                         this.checkAnswer();
                    }
                }
            });
        }

        generateProblem(level) {
            const problems = [
                // Basic problems (Level 1-3)
                () => {
                    const angles = [0, 30, 45, 60, 90, 120, 135, 150, 180];
                    const functions = ['sin', 'cos', 'tan'];
                    const angle = angles[Math.floor(Math.random() * angles.length)]; // FIX: Use full array length
                    const func = functions[Math.floor(Math.random() * 3)];
                    
                    const values = {
                        sin: { 0: '0', 30: '0.5', 45: '0.707', 60: '0.866', 90: '1', 120: '0.866', 135: '0.707', 150: '0.5', 180: '0' },
                        cos: { 0: '1', 30: '0.866', 45: '0.707', 60: '0.5', 90: '0', 120: '-0.5', 135: '-0.707', 150: '-0.866', 180: '-1' },
                        tan: { 0: '0', 30: '0.577', 45: '1', 60: '1.732', 90: 'undefined', 120: '-1.732', 135: '-1', 150: '-0.577', 180: '0' }
                    };
                    
                    const answer = values[func][angle];
                    if (answer === 'undefined') return this.generateProblem(level); // Re-roll if tan(90)
                    
                    return {
                        question: `‡∏´‡∏≤‡∏Ñ‡πà‡∏≤‡∏Ç‡∏≠‡∏á ${func}(${angle}¬∞)`,
                        answer: answer,
                        hint: `‡πÉ‡∏ä‡πâ‡∏ß‡∏á‡∏Å‡∏•‡∏°‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏´‡∏ô‡πà‡∏ß‡∏¢ ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏≤‡∏°‡πÄ‡∏´‡∏•‡∏µ‡πà‡∏¢‡∏°‡∏°‡∏∏‡∏°‡∏â‡∏≤‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô (30-60-90 ‡∏´‡∏£‡∏∑‡∏≠ 45-45-90)`,
                        explanation: `${func}(${angle}¬∞) ‚âà ${answer}`
                    };
                },

                // Pythagorean identity (Level 4-6)
                () => {
                    const angle = [30, 45, 60, 120][Math.floor(Math.random() * 4)];
                    return {
                        question: `‡∏´‡∏≤‡∏Ñ‡πà‡∏≤‡∏Ç‡∏≠‡∏á sin¬≤(${angle}¬∞) + cos¬≤(${angle}¬∞)`,
                        answer: '1',
                        hint: '‡πÄ‡∏≠‡∏Å‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå‡∏û‡∏µ‡∏ó‡∏≤‡πÇ‡∏Å‡∏£‡∏±‡∏™: sin¬≤(Œ∏) + cos¬≤(Œ∏) = 1 ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡πÜ ‡∏°‡∏∏‡∏° Œ∏',
                        explanation: `‡∏à‡∏≤‡∏Å‡πÄ‡∏≠‡∏Å‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå sin¬≤(Œ∏) + cos¬≤(Œ∏) = 1 ‡πÄ‡∏™‡∏°‡∏≠ ‡∏î‡∏±‡∏á‡∏ô‡∏±‡πâ‡∏ô‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏∑‡∏≠ 1`
                    };
                },

                // Double angle (Level 5+)
                () => {
                    const angle = [15, 22.5, 30][Math.floor(Math.random() * 3)];
                    const func = ['sin', 'cos'][Math.floor(Math.random() * 2)];
                    const doubleAngle = angle * 2;
                    
                    const values = {
                        sin: { 30: '0.5', 45: '0.707', 60: '0.866' },
                        cos: { 30: '0.866', 45: '0.707', 60: '0.5' }
                    };
                    
                    const answer = values[func][doubleAngle];
                    const hints = {
                        sin: 'sin(2Œ∏) = 2sin(Œ∏)cos(Œ∏)',
                        cos: 'cos(2Œ∏) = cos¬≤(Œ∏) - sin¬≤(Œ∏)'
                    };
                    
                    return {
                        question: `‡∏´‡∏≤‡∏Ñ‡πà‡∏≤‡∏Ç‡∏≠‡∏á ${func}(${doubleAngle}¬∞)`,
                        answer: answer,
                        hint: `‡πÉ‡∏ä‡πâ‡∏™‡∏π‡∏ï‡∏£‡∏°‡∏∏‡∏°‡∏™‡∏≠‡∏á‡πÄ‡∏ó‡πà‡∏≤: ${hints[func]}`,
                        explanation: `‡∏à‡∏≤‡∏Å‡∏™‡∏π‡∏ï‡∏£‡∏°‡∏∏‡∏°‡∏™‡∏≠‡∏á‡πÄ‡∏ó‡πà‡∏≤, ${func}(${doubleAngle}¬∞) ‚âà ${answer}`
                    };
                },

                // Sum/Difference formulas (Level 7+)
                () => {
                    const angle1 = [30, 45, 60][Math.floor(Math.random() * 3)];
                    const angle2 = [30, 45, 60][Math.floor(Math.random() * 3)];
                    if (angle1 === angle2) return this.generateProblem(level); // Avoid easy questions like 30-30=0
                    const operation = Math.random() > 0.5 ? '+' : '-';
                    const func = ['sin', 'cos'][Math.floor(Math.random() * 2)];
                    
                    const resultAngle = operation === '+' ? angle1 + angle2 : Math.abs(angle1 - angle2);
                    
                    const values = {
                        sin: { 15: '0.259', 75: '0.966', 90: '1', 105: '0.966', 120: '0.866' },
                        cos: { 15: '0.966', 75: '0.259', 90: '0', 105: '-0.259', 120: '-0.5' }
                    };
                    
                    const answer = values[func][resultAngle];
                     if (!answer) return this.generateProblem(level); // Re-roll if combination is not in the list
                    const hints = {
                        sin: `sin(A ¬± B) = sin(A)cos(B) ¬± cos(A)sin(B)`,
                        cos: `cos(A ¬± B) = cos(A)cos(B) ‚àì sin(A)sin(B)`
                    };
                    
                    return {
                        question: `‡∏´‡∏≤‡∏Ñ‡πà‡∏≤‡∏Ç‡∏≠‡∏á ${func}(${angle1}¬∞ ${operation} ${angle2}¬∞)`,
                        answer: answer,
                        hint: `‡πÉ‡∏ä‡πâ‡∏™‡∏π‡∏ï‡∏£‡∏ú‡∏•‡∏ö‡∏ß‡∏Å/‡∏ú‡∏•‡∏ï‡πà‡∏≤‡∏á‡∏°‡∏∏‡∏°: ${hints[func]}`,
                        explanation: `${func}(${angle1}¬∞ ${operation} ${angle2}¬∞) = ${func}(${resultAngle}¬∞) ‚âà ${answer}`
                    };
                },

                // Solve Equations (Level 8+)
                () => {
                    const problemData = [
                        {
                            q: '‡πÅ‡∏Å‡πâ‡∏™‡∏°‡∏Å‡∏≤‡∏£ 2sin(x) - 1 = 0 ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö 0¬∞ ‚â§ x < 360¬∞ (‡∏ï‡∏≠‡∏ö‡∏°‡∏∏‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏á‡∏®‡∏≤ ‡∏Ñ‡∏±‡πà‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏à‡∏∏‡∏•‡∏†‡∏≤‡∏Ñ ,)',
                            a: ['30', '150'],
                            h: '‡∏¢‡πâ‡∏≤‡∏¢‡∏Ç‡πâ‡∏≤‡∏á‡∏™‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏≤‡∏Ñ‡πà‡∏≤ sin(x) ‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏≤‡∏°‡∏∏‡∏°‡πÉ‡∏ô‡∏ß‡∏á‡∏Å‡∏•‡∏°‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏´‡∏ô‡πà‡∏ß‡∏¢',
                            e: '‡∏à‡∏≤‡∏Å 2sin(x) - 1 = 0 ‡∏à‡∏∞‡πÑ‡∏î‡πâ sin(x) = 1/2 ‡∏î‡∏±‡∏á‡∏ô‡∏±‡πâ‡∏ô x = 30¬∞ ‡πÅ‡∏•‡∏∞ 150¬∞'
                        },
                        {
                            q: '‡∏ñ‡πâ‡∏≤ sin(Œ∏) = 3/5 ‡πÅ‡∏•‡∏∞ Œ∏ ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏à‡∏ï‡∏∏‡∏†‡∏≤‡∏Ñ‡∏ó‡∏µ‡πà 1, ‡∏´‡∏≤‡∏Ñ‡πà‡∏≤‡∏Ç‡∏≠‡∏á cos(Œ∏) (‡∏ï‡∏≠‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏°)',
                            a: ['0.8'],
                            h: '‡πÉ‡∏ä‡πâ‡πÄ‡∏≠‡∏Å‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå sin¬≤(Œ∏) + cos¬≤(Œ∏) = 1',
                            e: 'cos¬≤(Œ∏) = 1 - (3/5)¬≤ = 1 - 9/25 = 16/25\n‡πÉ‡∏ô‡∏à‡∏ï‡∏∏‡∏†‡∏≤‡∏Ñ‡∏ó‡∏µ‡πà 1, cos(Œ∏) ‡πÄ‡∏õ‡πá‡∏ô‡∏ö‡∏ß‡∏Å ‡∏î‡∏±‡∏á‡∏ô‡∏±‡πâ‡∏ô cos(Œ∏) = 4/5 = 0.8'
                        }
                    ];
                    
                    const problem = problemData[Math.floor(Math.random() * problemData.length)];
                    return {
                        question: problem.q,
                        answer: problem.a, // Answer is now an array
                        hint: problem.h,
                        explanation: problem.e,
                        isEquation: true // Add a flag for special answer checking
                    };
                }
            ];

            // Select problem type based on level
            if (level <= 3) return problems[0]();
            if (level <= 5) return Math.random() < 0.4 ? problems[1]() : problems[0]();
            if (level <= 7) return [problems[0], problems[1], problems[2]][Math.floor(Math.random() * 3)]();
            if (level <= 10) return [problems[1], problems[2], problems[3]][Math.floor(Math.random() * 3)]();
            return [problems[2], problems[3], problems[4]][Math.floor(Math.random() * 3)]();
        }

        generateNewProblem() {
            this.currentProblem = this.generateProblem(this.currentLevel);
            this.elements.questionDisplay.textContent = this.currentProblem.question;
            this.hideHint();
            this.hideFeedback();
            this.hideNextButton();
        }

        getDifficulty() {
            if (this.currentLevel <= 3) return { name: '‡∏á‡πà‡∏≤‡∏¢', class: 'difficulty-easy' };
            if (this.currentLevel <= 6) return { name: '‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á', class: 'difficulty-medium' };
            if (this.currentLevel <= 10) return { name: '‡∏¢‡∏≤‡∏Å', class: 'difficulty-hard' };
            return { name: '‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç', class: 'difficulty-expert' };
        }

        updateDisplay() {
            const difficulty = this.getDifficulty();
            
            this.elements.levelDisplay.textContent = this.currentLevel;
            this.elements.scoreDisplay.textContent = this.score;
            this.elements.streakDisplay.textContent = this.streak;
            this.elements.bestStreakDisplay.textContent = this.bestStreak;
            
            this.elements.difficultyBadge.textContent = `‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å: ${difficulty.name}`;
            this.elements.difficultyBadge.className = `rounded-full px-4 py-2 font-semibold ${difficulty.class}`;
        }

        checkAnswer() {
            const userAnswer = this.elements.answerInput.value.trim();
            if (!userAnswer) {
                this.showFeedback('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö', 'hint');
                return;
            }

            let isCorrect = false;
            if (this.currentProblem.isEquation) {
                // Handle multi-part answers (e.g., "30, 150")
                const correctValues = this.currentProblem.answer;
                const userValues = userAnswer.split(',').map(val => val.trim()).sort();
                isCorrect = correctValues.length === userValues.length && correctValues.every((val, index) => val === userValues[index]);
            } else {
                // Handle single numeric answers
                const correctAnswer = this.currentProblem.answer;
                isCorrect = userAnswer === correctAnswer;
            }
            
            if (isCorrect) {
                const points = Math.max(5, 15 - Math.floor(this.currentLevel / 2));
                this.score += points;
                this.streak++;
                this.bestStreak = Math.max(this.bestStreak, this.streak);
                
                this.showFeedback(`‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á! +${points} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô\n\n‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢:\n${this.currentProblem.explanation}`, 'correct');
                this.showNextButton();
            } else {
                this.streak = 0;
                const correctAnswerText = Array.isArray(this.currentProblem.answer) 
                    ? this.currentProblem.answer.join(', ') 
                    : this.currentProblem.answer;
                this.showFeedback(`‡∏ú‡∏¥‡∏î! ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏∑‡∏≠: ${correctAnswerText}\n\n‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢:\n${this.currentProblem.explanation}`, 'wrong');
                 this.showNextButton(); // Show next button even if wrong
            }
            
            this.updateDisplay();
        }

        showFeedback(message, type) {
            const icons = { correct: '‚úÖ', wrong: '‚ùå', hint: 'üí°' };
            const feedbackClasses = { correct: 'feedback-correct', wrong: 'feedback-wrong', hint: 'feedback-hint' };
            const textClasses = { correct: 'text-green-100', wrong: 'text-red-100', hint: 'text-yellow-100' };

            this.elements.feedbackIcon.textContent = icons[type];
            this.elements.feedbackText.textContent = message;

            // IMPROVEMENT: Use classList for safer class management
            const feedbackDisplay = this.elements.feedbackDisplay;
            feedbackDisplay.classList.remove('feedback-correct', 'feedback-wrong', 'feedback-hint', 'hidden');
            feedbackDisplay.classList.add(feedbackClasses[type]);
            
            const feedbackText = this.elements.feedbackText;
            feedbackText.classList.remove('text-green-100', 'text-red-100', 'text-yellow-100');
            feedbackText.classList.add(textClasses[type]);
        }

        hideFeedback() {
            this.elements.feedbackDisplay.classList.add('hidden');
        }

        toggleHint() {
            if (this.showingHint) {
                this.hideHint();
            } else {
                this.showHint();
            }
        }

        showHint() {
            this.elements.hintText.textContent = this.currentProblem.hint;
            this.elements.hintDisplay.classList.remove('hidden');
            this.elements.hintBtn.textContent = '‡∏ã‡πà‡∏≠‡∏ô‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ';
            this.showingHint = true;
        }

        hideHint() {
            this.elements.hintDisplay.classList.add('hidden');
            this.elements.hintBtn.textContent = '‡∏Ç‡∏≠‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ';
            this.showingHint = false;
        }

        showNextButton() {
            this.elements.nextBtn.classList.remove('hidden');
            this.elements.checkBtn.classList.add('hidden');
            this.elements.hintBtn.classList.add('hidden');
            this.elements.answerInput.disabled = true;
        }

        hideNextButton() {
            this.elements.nextBtn.classList.add('hidden');
            this.elements.checkBtn.classList.remove('hidden');
            this.elements.hintBtn.classList.remove('hidden');
            this.elements.answerInput.disabled = false;
            this.elements.answerInput.focus();
        }

        nextLevel() {
            this.currentLevel++;
            this.elements.answerInput.value = '';
            this.generateNewProblem();
            this.updateDisplay();
        }

        resetGame() {
            this.currentLevel = 1;
            this.score = 0;
            this.streak = 0;
            // Note: bestStreak is not reset by design, to keep the player's record
            this.elements.answerInput.value = '';
            this.generateNewProblem();
            this.updateDisplay();
        }
    }

    // Start the game when the page is fully loaded
    document.addEventListener('DOMContentLoaded', () => {
        new TrigonometryGame();
    });
</script>
</body>
</html>
